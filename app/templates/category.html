{% extends "base.html" %}

{% block title %}Category Management{% endblock %}

{% block extra_css %}
  <link href="{{ url_for('static', filename='css/category.css') }}" rel="stylesheet" />
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">Categories</h2>
  <button class="btn btn-primary" id="btnAdd">Add Category</button>
</div>


  <table id="categoryTable" class="table table-striped table-hover table-bordered align-middle rounded-3 overflow-hidden shadow">
  <thead>
    <tr>
      <th>ID</th>
      <th>Created By</th>  <!-- Added Created By column -->
      <th>Name</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for c in categories %}
    <tr data-id="{{ c.id }}">
      <td>{{ c.id }}</td>
      <td>{{ c.created_by or '-' }}</td>  <!-- Show creator email prefix -->
      <td class="category-name">{{ c.name|lower|trim }}</td>
      <td>
        <div class="form-check form-switch">
          <input type="checkbox" class="form-check-input status-toggle" id="toggle-{{ c.id }}" data-id="{{ c.id }}" {% if c.status == '1' %}checked{% endif %} />
          <label class="form-check-label" for="toggle-{{ c.id }}"></label>
        </div>
      </td>
      <td>
        <button class="btn btn-sm btn-info btn-edit">Edit</button>
        <button class="btn btn-sm btn-danger btn-delete">Delete</button>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>




<!-- Modal -->
<div class="modal fade" id="categoryModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <form id="categoryForm" novalidate>
      <div class="modal-content">
        <div class="modal-header text-bold text-white">
          <h5 class="modal-title" id="modalTitle">Add Category</h5>
          <button type="button" class="btn btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <!-- Removed category code input and container entirely -->
          <div class="mb-3">
            <label for="categoryName" class="form-label">Category Name<span class="required-asterisk">*</span></label>
            <input type="text" class="form-control" id="categoryName" name="name" required autocomplete="off" />
            <div id="nameError" class="error-message d-none">This category already exists.</div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary" id="saveBtn">Save</button>
        </div>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block extra_js %}
  <script src="{{ url_for('static', filename='js/category.js') }}"></script>
{% endblock %}